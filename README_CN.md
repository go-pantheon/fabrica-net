<div align="center">
  <h1>ğŸ›ï¸ FABRICA NET</h1>
  <p><em>é¢å‘ go-pantheon ç”Ÿæ€ç³»ç»Ÿçš„é«˜æ€§èƒ½å¤šåè®®ç½‘ç»œåº“</em></p>
</div>

<p align="center">
<a href="https://github.com/go-pantheon/fabrica-net/actions/workflows/test.yml"><img src="https://github.com/go-pantheon/fabrica-net/workflows/Test/badge.svg" alt="Test Status"></a>
<a href="https://github.com/go-pantheon/fabrica-net/releases"><img src="https://img.shields.io/github/v/release/go-pantheon/fabrica-net" alt="Latest Release"></a>
<a href="https://pkg.go.dev/github.com/go-pantheon/fabrica-net"><img src="https://pkg.go.dev/badge/github.com/go-pantheon/fabrica-net" alt="GoDoc"></a>
<a href="https://goreportcard.com/report/github.com/go-pantheon/fabrica-net"><img src="https://goreportcard.com/badge/github.com/go-pantheon/fabrica-net" alt="Go Report Card"></a>
<a href="https://github.com/go-pantheon/fabrica-net/blob/main/LICENSE"><img src="https://img.shields.io/github/license/go-pantheon/fabrica-net" alt="License"></a>
<a href="https://deepwiki.com/go-pantheon/fabrica-net"><img src="https://deepwiki.com/badge.svg" alt="Ask DeepWiki"></a>
</p>

> **è¯­è¨€**: [English](README.md) | [ä¸­æ–‡](README_CN.md)

## å…³äº Fabrica Net

Fabrica Net æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ã€ä¼ä¸šçº§ç½‘ç»œåº“ï¼Œä¸“é—¨ä¸º [go-pantheon/janus](https://github.com/go-pantheon/janus) ç½‘å…³æœåŠ¡è®¾è®¡ã€‚å®ƒä¸ºæ¸¸æˆæœåŠ¡å™¨åŸºç¡€è®¾æ–½æä¾›å®‰å…¨çš„å¤šåè®®é€šä¿¡èƒ½åŠ›ã€å…ˆè¿›çš„ä¼šè¯ç®¡ç†å’Œå®æ—¶ç›‘æ§åŠŸèƒ½ã€‚

æ›´å¤šä¿¡æ¯è¯·è®¿é—®ï¼š[deepwiki/go-pantheon/fabrica-net](https://deepwiki.com/go-pantheon/fabrica-net)

## å…³äº go-pantheon ç”Ÿæ€ç³»ç»Ÿ

**go-pantheon** æ˜¯ä¸€ä¸ªå¼€ç®±å³ç”¨çš„æ¸¸æˆæœåŠ¡å™¨æ¡†æ¶ï¼ŒåŸºäº [go-kratos](https://github.com/go-kratos/kratos) å¾®æœåŠ¡æ¶æ„æä¾›é«˜æ€§èƒ½ã€é«˜å¯ç”¨çš„æ¸¸æˆæœåŠ¡å™¨é›†ç¾¤è§£å†³æ–¹æ¡ˆã€‚Fabrica Net ä½œä¸ºç½‘ç»œé€šä¿¡åŸºç¡€ï¼Œæ”¯æ’‘ä»¥ä¸‹æ ¸å¿ƒç»„ä»¶ï¼š

- **Roma**: æ¸¸æˆæ ¸å¿ƒé€»è¾‘æœåŠ¡
- **Janus**: å®¢æˆ·ç«¯è¿æ¥å¤„ç†å’Œè¯·æ±‚è½¬å‘çš„ç½‘å…³æœåŠ¡
- **Lares**: ç”¨æˆ·è®¤è¯å’Œè´¦æˆ·ç®¡ç†çš„è´¦å·æœåŠ¡
- **Senate**: æä¾›è¿è¥æ¥å£çš„åå°ç®¡ç†æœåŠ¡

### æ ¸å¿ƒç‰¹æ€§

- ğŸŒ **å¤šåè®®æ”¯æŒ**: TCPã€KCP å’Œ WebSocket ç»Ÿä¸€ API
- ğŸ”’ **ä¼ä¸šçº§å®‰å…¨**: ECDH å¯†é’¥äº¤æ¢ä¸ AES-GCM åŠ å¯†
- âš¡ **é«˜æ€§èƒ½**: å·¥ä½œæ± æ¶æ„ä¸é›¶æ‹·è´æ“ä½œ
- ğŸ“Š **ç›‘æ§ä¸å¯è§‚æµ‹æ€§**: Prometheus æŒ‡æ ‡å’Œåˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª
- ğŸ”§ **ä¼šè¯ç®¡ç†**: å…¨é¢çš„ç”¨æˆ·ä¼šè¯ç”Ÿå‘½å‘¨æœŸç®¡ç†
- ğŸ›¡ï¸ **è¿æ¥ç®¡ç†**: è‡ªåŠ¨é‡è¿ä¸å¿ƒè·³æ£€æµ‹
- ğŸ”„ **ä¼˜é›…å…³é—­**: å¸¦è¿æ¥æ’ç©ºçš„è¶…æ—¶æ§åˆ¶å…³é—­
- ğŸ¯ **è´Ÿè½½å‡è¡¡**: åŸºäºæƒé‡çš„è·¯ç”±ä¸å¥åº·æ£€æŸ¥

## ç½‘ç»œåè®®

### TCP æœåŠ¡å™¨ (`tcp/server/`)
é«˜æ€§èƒ½ TCP æœåŠ¡å™¨ï¼Œæ”¯æŒè¿æ¥æ± ï¼š
- å¤šå·¥ä½œå™¨æ¶æ„å¤„ç†å¹¶å‘è¿æ¥
- å¯é…ç½®çš„ç¼“å†²åŒºå¤§å°å’Œä¿æ´»è®¾ç½®
- å¸¦é’©å­çš„è¿æ¥ç”Ÿå‘½å‘¨æœŸç®¡ç†
- æ”¯æŒè¯·æ±‚/å“åº”è¿‡æ»¤çš„ä¸­é—´ä»¶

### TCP å®¢æˆ·ç«¯ (`tcp/client/`)
å¥å£®çš„ TCP å®¢æˆ·ç«¯ï¼Œæ”¯æŒè‡ªåŠ¨é‡è¿ï¼š
- å¸¦ä¼šè¯ç®¡ç†çš„åŠ å¯†é€šä¿¡
- æŒ‡æ•°é€€é¿çš„é‡è¯•æœºåˆ¶
- è¿æ¥çŠ¶æ€è·Ÿè¸ªå’Œæ¢å¤

### ç½‘ç»œæŠ½è±¡ (`xnet/`)
æ ¸å¿ƒç½‘ç»œæŠ½è±¡å’Œå·¥å…·ï¼š
- **Session**: å¸¦åŠ å¯†å’ŒçŠ¶æ€ç®¡ç†çš„ç”¨æˆ·ä¼šè¯
- **Transport**: å¤šåè®®ä¼ è¾“å±‚å®ç°
- **Cryptor**: AES-GCM åŠ å¯†/è§£å¯†æ¥å£
- **ECDHable**: æ¤­åœ†æ›²çº¿ Diffie-Hellman å¯†é’¥äº¤æ¢

## æŠ€æœ¯æ ˆ

| æŠ€æœ¯/ç»„ä»¶           | ç”¨é€”         | ç‰ˆæœ¬    |
| ------------------- | ------------ | ------- |
| Go                  | ä¸»è¦å¼€å‘è¯­è¨€ | 1.23+   |
| go-kratos           | å¾®æœåŠ¡æ¡†æ¶   | v2.8.4  |
| fabrica-util        | é€šç”¨å·¥å…·åº“   | v0.0.18 |
| Prometheus          | æŒ‡æ ‡å’Œç›‘æ§   | v1.22.0 |
| gRPC                | æœåŠ¡é—´é€šä¿¡   | v1.73.0 |
| golang.org/x/crypto | åŠ å¯†æ“ä½œ     | v0.39.0 |

## ç³»ç»Ÿè¦æ±‚

- Go 1.23+

## å¿«é€Ÿå¼€å§‹

### å®‰è£…

```bash
go get github.com/go-pantheon/fabrica-net
```

### åˆå§‹åŒ–å¼€å‘ç¯å¢ƒ

```bash
make init
```

### è¿è¡Œæµ‹è¯•

```bash
make test
```

## ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ TCP æœåŠ¡å™¨

```go
package main

import (
    "context"
    "log"

    "github.com/go-pantheon/fabrica-net/tcp/server"
    "github.com/go-pantheon/fabrica-net/xnet"
)

type GameService struct{}

func (s *GameService) Handle(ctx context.Context, session xnet.Session, data []byte) error {
    log.Printf("ä»ç”¨æˆ· %d æ”¶åˆ°æ¶ˆæ¯: %s", session.UID(), string(data))
    return nil
}

func main() {
    service := &GameService{}

    srv, err := server.NewServer(service,
        server.Bind(":8080"),
        server.Logger(log.Default()),
    )
    if err != nil {
        log.Fatal(err)
    }

    ctx := context.Background()
    if err := srv.Start(ctx); err != nil {
        log.Fatal(err)
    }

    select {} // ä¿æŒè¿è¡Œ
}
```

### TCP å®¢æˆ·ç«¯è¿æ¥

```go
package main

import (
    "context"
    "log"
    "time"

    "github.com/go-pantheon/fabrica-net/tcp/client"
)

func main() {
    // åˆ›å»ºå¸¦ ID å’Œç»‘å®šåœ°å€çš„ TCP å®¢æˆ·ç«¯
    client := client.NewClient(12345, client.Bind("localhost:8080"))

    // å¯åŠ¨è¿æ¥
    ctx := context.Background()
    if err := client.Start(ctx); err != nil {
        log.Fatal(err)
    }
    defer client.Close()

    // å‘é€æ¶ˆæ¯
    message := []byte("ä½ å¥½æœåŠ¡å™¨!")
    if err := client.Send(message); err != nil {
        log.Fatal(err)
    }

    // æ¥æ”¶æ¶ˆæ¯
    go func() {
        for data := range client.Receive() {
            log.Printf("æ”¶åˆ°æ¶ˆæ¯: %s", string(data))
        }
    }()

    // ä¿æŒå®¢æˆ·ç«¯è¿è¡Œ
    time.Sleep(time.Second * 5)
}
```

### ä¼šè¯ç®¡ç†ä¸åŠ å¯†

```go
package main

import (
    "log"
    "time"

    "github.com/go-pantheon/fabrica-net/xnet"
)

func main() {
    // åˆ›å»ºåŠ å¯†ä¼šè¯
    key := []byte("0123456789abcdef0123456789abcdef")
    cryptor, err := xnet.NewCryptor(key)
    if err != nil {
        log.Fatal(err)
    }

    session := xnet.NewSession(12345, 1, time.Now().Unix(), cryptor, xnet.NewUnECDH(), "game", 1)

    // åŠ å¯†æ•°æ®
    data := []byte("æ•æ„Ÿæ¸¸æˆæ•°æ®")
    encrypted, err := session.Encrypt(data)
    if err != nil {
        log.Fatal(err)
    }

    // è§£å¯†æ•°æ®
    decrypted, err := session.Decrypt(encrypted)
    if err != nil {
        log.Fatal(err)
    }

    log.Printf("åŸå§‹æ•°æ®: %s, è§£å¯†å: %s", data, decrypted)
}
```

### é…ç½®è®¾ç½®

```go
package main

import (
    "time"

    "github.com/go-pantheon/fabrica-net/conf"
)

func main() {
    config := conf.Config{
        Server: conf.Server{
            WorkerSize:   8,
            Bind:         ":7000",
            WriteBufSize: 30000,
            ReadBufSize:  30000,
            KeepAlive:    true,
            StopTimeout:  time.Second * 30,
        },
        Worker: conf.Worker{
            ReaderBufSize:         8192,
            ReplyChanSize:         1024,
            HandshakeTimeout:      time.Second * 10,
            RequestIdleTimeout:    time.Second * 60,
            StopTimeout:           time.Second * 3,
            TunnelGroupSize:       32,
            TickInterval:          time.Second * 10,
        },
    }

    // ä½¿ç”¨é…ç½®...
}
```

## é¡¹ç›®ç»“æ„

```
.
â”œâ”€â”€ tcp/                # TCP åè®®å®ç°
â”‚   â”œâ”€â”€ server/         # å¸¦å·¥ä½œæ± çš„ TCP æœåŠ¡å™¨
â”‚   â””â”€â”€ client/         # å¸¦è‡ªåŠ¨é‡è¿çš„ TCP å®¢æˆ·ç«¯
â”œâ”€â”€ xnet/               # æ ¸å¿ƒç½‘ç»œæŠ½è±¡
â”‚   â”œâ”€â”€ session.go      # ä¼šè¯ç®¡ç†
â”‚   â”œâ”€â”€ transport.go    # ä¼ è¾“å±‚
â”‚   â”œâ”€â”€ crypto.go       # AES-GCM åŠ å¯†
â”‚   â””â”€â”€ ecdh.go         # ECDH å¯†é’¥äº¤æ¢
â”œâ”€â”€ xcontext/           # ä¸Šä¸‹æ–‡å·¥å…·
â”œâ”€â”€ http/               # HTTP å·¥å…·
â”‚   â””â”€â”€ health/         # å¥åº·æ£€æŸ¥ç«¯ç‚¹
â”œâ”€â”€ middleware/         # ä¸­é—´ä»¶ç»„ä»¶
â”œâ”€â”€ internal/           # å†…éƒ¨å®ç°
â”‚   â”œâ”€â”€ manager.go      # å·¥ä½œå™¨ç®¡ç†å™¨
â”‚   â”œâ”€â”€ worker.go       # è¿æ¥å·¥ä½œå™¨
â”‚   â””â”€â”€ tunnel.go       # é€šä¿¡éš§é“
â””â”€â”€ conf/               # é…ç½®ç®¡ç†
```

## ä¸ go-pantheon ç»„ä»¶é›†æˆ

Fabrica Net ä¸“ä¸ºå…¶ä»– go-pantheon ç»„ä»¶å¯¼å…¥è€Œè®¾è®¡ï¼š

```go
import (
    // Janus ç½‘å…³çš„ TCP æœåŠ¡å™¨
    "github.com/go-pantheon/fabrica-net/tcp/server"

    // ç”¨æˆ·è¿æ¥çš„ä¼šè¯ç®¡ç†
    "github.com/go-pantheon/fabrica-net/xnet"

    // è´Ÿè½½å‡è¡¡å™¨çš„å¥åº·æ£€æŸ¥
    "github.com/go-pantheon/fabrica-net/http/health"

    // é…ç½®ç®¡ç†
    "github.com/go-pantheon/fabrica-net/conf"
)
```

## å¼€å‘æŒ‡å—

### ç¯å¢ƒé…ç½®

é€šè¿‡ç¯å¢ƒå˜é‡é…ç½® fabrica-netï¼š

```bash
export REGION="us-west-1"           # éƒ¨ç½²åŒºåŸŸ
export ZONE="us-west-1a"            # å¯ç”¨åŒº
export DEPLOY_ENV="production"      # ç¯å¢ƒ (dev/staging/prod)
export ADDRS="10.0.1.100"          # æœåŠ¡å™¨å…¬ç½‘ IP åœ°å€
export WEIGHT="100"                 # è´Ÿè½½å‡è¡¡æƒé‡
export OFFLINE="false"              # ç¦»çº¿æ¨¡å¼æ ‡å¿—
```

### æµ‹è¯•

è¿è¡Œå®Œæ•´çš„æµ‹è¯•å¥—ä»¶ï¼š

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
make test

# è¿è¡ŒåŸºå‡†æµ‹è¯•
make benchmark

# è¿è¡Œä»£ç æ£€æŸ¥
make lint
```

### æ·»åŠ æ–°åè®®

æ·»åŠ æ–°ç½‘ç»œåè®®æ—¶ï¼š

1. åœ¨åè®®åç§°ä¸‹åˆ›å»ºæ–°åŒ…ï¼ˆå¦‚ `kcp/`ã€`websocket/`ï¼‰
2. å®ç°æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ç»„ä»¶
3. éµå¾ªç°æœ‰ TCP å®ç°æ¨¡å¼
4. æ·»åŠ å…¨é¢çš„å•å…ƒæµ‹è¯•å’ŒåŸºå‡†æµ‹è¯•
5. ä½¿ç”¨ç¤ºä¾‹æ›´æ–°æ–‡æ¡£
6. ç¡®ä¿ä¸ç°æœ‰ `xnet` æŠ½è±¡çš„å…¼å®¹æ€§

### è´¡çŒ®æŒ‡å—

1. Fork æ­¤ä»“åº“
2. ä» `main` åˆ†æ”¯åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. å®ç°æ›´æ”¹å¹¶ç¼–å†™å…¨é¢çš„æµ‹è¯•
4. ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡ä¸”ä»£ç æ£€æŸ¥æ— è¯¯
5. æ›´æ–°ä»»ä½• API æ›´æ”¹çš„æ–‡æ¡£
6. æäº¤å¸¦æœ‰æ¸…æ™°æè¿°çš„ Pull Request

## æ€§èƒ½è€ƒè™‘

- **è¿æ¥æ± **: TCP æœåŠ¡å™¨ä½¿ç”¨å·¥ä½œæ± ä¼˜åŒ–è¿æ¥å¤„ç†
- **å†…å­˜ç®¡ç†**: å°½å¯èƒ½ä½¿ç”¨é›¶æ‹·è´æ“ä½œå‡å°‘ GC å‹åŠ›
- **åŠ å¯†**: AES-GCM æ“ä½œé’ˆå¯¹é«˜ååé‡è¿›è¡Œä¼˜åŒ–
- **ä¼šè¯ç®¡ç†**: ä¼šè¯çŠ¶æ€è¢«ç¼“å­˜ä»¥æœ€å°åŒ–æŸ¥æ‰¾å¼€é”€
- **ç¼“å†²åŒºç®¡ç†**: é’ˆå¯¹ä¸åŒå·¥ä½œè´Ÿè½½æ¨¡å¼çš„å¯é…ç½®ç¼“å†²åŒºå¤§å°
- **ä¼˜é›…å…³é—­**: è¿æ¥æ’ç©ºé˜²æ­¢é‡å¯æœŸé—´çš„æ•°æ®ä¸¢å¤±

## è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäº LICENSE æ–‡ä»¶ä¸­æŒ‡å®šçš„æ¡æ¬¾æˆæƒã€‚
